<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- <meta http-equiv="refresh" content="10"> -->
  <!-- Actualizar pagina cada 10 seg -->

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
  <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css')}}" />
  <!-- CSS se carga diferente por el template jinja. Se crea direc Static -->
  <!--<link rel="stylesheet" href="dashboard.css" /> -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

  <!--HighChart Gráficos-->
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/modules/boost.js"></script>
  <script src="https://code.highcharts.com/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/modules/data.js"></script> <!--Mostrar datos de csv-->

  <script type="text/javascript">

    $(document).ready(function () {


      function update() {
        console.log("Entrando a funcion");

        //var getDate = new Date(); determinar hora y fecha desde js

        $.ajax({                    /* $.ajax(url, objeto-configurable) success: funcion que se ejecuta si la peticion es correcta*/

          url: 'http://localhost:5000/update',
          success: function (data) {
            console.log(data)
            //var dato=JSON.parse(data);

            console.log("Recibiendo valor de sensor")

            console.log(data.valor1);
            console.log(data.valor2);
            console.log(data.valor3);

            var t = data.valor1;
            var h = data.valor2;
            var tim = data.valor3;


            $('#temp').html(t);
            $('#hum').html(h);
            $('#tim').html(tim);  //Como es un ID se referencia con #
            /*$('p').html(data)*/
          }
        });

       /*  Highcharts.chart('containerTem', {
          chart: {
            type: 'spline'
          },

          title: {
            text: 'Monitoreo de Temperatura y humedad'
          },          

          data: {
           
            csvURL:'http://localhost:5000/download/sensor.csv',
            enablePolling: true,
            dataRefreshRate: 5

          },

         

          plotOptions: {
        series: {
            connectNulls: true  //No aparecian las lineas. Con esa opción se soluciona eso
            /*marker: {
                enabled: true
            } *///otra opcion para mostrar lineas que unen los datos
        //}
    //}

       // }); */



      }
      setInterval(update, 3000);

      function grafica(){  //prueba para gráfica
        Highcharts.chart('containerTem', {
          chart: {
            type: 'spline'
          },

          title: {
            text: 'Monitoreo de Temperatura y humedad'
          },

          /*xAxis: {
            //categories:['lunes','martes','miercoes','jueves','viernes','sabado','domingo']
            //type:'datetime',
            /*labels:{
              format: '{value:@Y-@m-@d}'
            }
          },

          yAxis: {
            title: {

              text: 'Temperature (°C)'

            }


          },
          /*series:[{
            //data:[[2,5],[5,8],[9,1]]
            name:'Datos sensores',
            
          }],*/

       

          /*data: {
            //csv:'/archivos/sensor.csv'
            csvURL: 'https://raw.githubusercontent.com/mekhatria/demo_highcharts/master/globalTemperatureChange.csv',
            enablePolling: true
          },*/

          data: {
           
            csvURL:'http://localhost:5000/download/sensor.csv',
            enablePolling: true,
            dataRefreshRate: 5
            

          },

         

          plotOptions: {
        series: {
            connectNulls: true  //No aparecian las lineas. Con esa opción se soluciona eso
            /*marker: {
                enabled: true
            } *///otra opcion para mostrar lineas que unen los datos
        }
    }

        });

      }
      setInterval(grafica, 5000);
    });

  </script>

  <title>Dashboard</title>
</head>

<body id="body">
  <!-- Titulo -->
  <div class="container">
    <div class="row">
      <div class="col text-center text-uppercase">
        <h1>Dashboard</h1>
      </div>
    </div>
  </div>
  <!-- /Titulo -->

  <!-- Datos -->
  <section id="data" class="mt-4 mb-4 ">
    <div class="container">

      <div class="row">
        <div class="col-md-4">
          <!--col-md-4:para que cada columna tome un ancho de 4-->
          <div class="card" style="width: 18rem;">
            <img src="static/imagenes/thermometer.png" class="card-img-top" alt="img temperatura">
            <!-- Imagenes en dir Static-->

            <div class="card-body">
              <h5 class="card-title text-center">Temperatura</h5>
              <span class="badge bg-warning text-dark text-center">°C</span>
              <span class="badge bg-info text-dark">house</span>
              <p id="temp" class="fw-bold text-uppercase text-center fs-1">{{ value }} °C </p>


            </div>
          </div>
        </div>

        <div class="col-md-4">
          <!--col-md-4:para que cada columna tome un ancho de 4-->
          <div class="card" style="width: 18rem;">
            <img src="static/imagenes/humedad.png" class="card-img-top" alt="img temperatura">
            <div class="card-body">
              <h5 class="card-title text-center">Humedad</h5>
              <p id="hum" class="fw-bold text-uppercase text-center fs-1">{{ value2 }} %</p>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <!--col-md-4:para que cada columna tome un ancho de 4-->
          <div class="card">
            <img src="static/imagenes/hora.png" class="card-img-top" alt="img temperatura">
            <div class="card-body">
              <h5 class="card-title text-center">Tiempo</h5>
              <p id='tim' class="card-text fw-bold text-uppercase text-center fs-1">{{value3}}</p>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>
  <!-- /Datos -->

  <!--On/off-->
  <div class="container">
    <div class="row">
      <div class="col">
        <div class="card">

          <div class="card-body">
            <h5 class="card-title">Turn on</h5>

            <form action="/valorSensor" method="post">
              <p><input class="btn btn-encender" type="submit" name="submit" value="Encender"> </p>
            </form>

          </div>
        </div>
      </div>
      <div class="col">
        <div class="card">

          <div class="card-body">
            <h5 class="card-title">Turn Off</h5>
            <form action="/valorSensor" method="post">
              <p><input class="btn btn-outline-dark" type="submit" name="submit" value="Apagar"> </p>
            </form>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!--/On/off-->




  <!-- Graficos -->

  <section id="data" class="mt-4 mb-4 ">
    <div class="container">

      <div class="row">
        <div class="col-md-6">
          <!--col-md-4:para que cada columna tome un ancho de 4-->
          <div class="card">

            <div class="card-body">
              <h5 class="card-title">Grafica Temperatura</h5>

              <p class="card-text">Datos de temperatura y humedad</p>
              <!--<img src="static/imagenes/grafica.png" class="card-img-top" alt="img temperatura">-->
              <div id="containerTem" style="height: 400px; max-width: 800px; margin: 0 auto"></div>

            </div>
          </div>
        </div>

        
      </div>
    </div>
  </section>
  <!-- /Graficos -->

  <!-- Footer -->
  <footer id="footer">
    <div class="container">
      <div class="row">
        <div class="col text-center text-uppercase">
          Elaborado por Jhorman Villanueva
        </div>
      </div>
    </div>
  </footer>

  <!-- /Footer -->






  <!-- Optional JavaScript; choose one of the two! -->

  <!-- Option 1: Bootstrap Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
    crossorigin="anonymous"></script>

  <!-- Option 2: Separate Popper and Bootstrap JS -->
  <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js" integrity="sha384-SR1sx49pcuLnqZUnnPwx6FCym0wLsk5JZuNx2bPPENzswTNFaQU1RDvt3wT4gWFG" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js" integrity="sha384-j0CNLUeiqtyaRmlzUHCPZ+Gy5fQu0dQ6eZ/xAww941Ai1SxSY+0EQqNXNE6DZiVc" crossorigin="anonymous"></script>
    -->
</body>

</html>